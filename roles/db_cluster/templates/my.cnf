[mysqld]
# General settings
bind-address=*
port=3306
user=mysql
pid-file=/var/run/mysqld/mysqld.pid
socket=/var/run/mysqld/mysqld.sock
datadir=/var/lib/mysql
secure-file-priv=/var/lib/mysql-files
basedir=/usr
tmpdir=/tmp
lc-messages-dir=/usr/share/mysql

# Character Set
character-set-server={{ mysql_character_set }}
collation-server={{ mysql_collation }}

# InnoDB settings
innodb_buffer_pool_size={{ mysql_innodb_buffer_pool_size }}
innodb_log_file_size={{ mysql_innodb_log_file_size }}
innodb_flush_log_at_trx_commit={{ mysql_innodb_flush_log_at_trx_commit }}
innodb_flush_method={{ mysql_innodb_flush_method }}
innodb_autoinc_lock_mode=2
innodb_doublewrite=1
innodb_read_io_threads=4
innodb_write_io_threads=4

# Group Replication settings
plugin_load_add='group_replication.so'
group_replication=FORCE_PLUS_PERMANENT
group_replication_group_name="{{ mysql_group_replication_name }}"
group_replication_start_on_boot=OFF
group_replication_bootstrap_group=OFF
group_replication_single_primary_mode=ON
group_replication_enforce_update_everywhere_checks=OFF
group_replication_local_address="mysql_primary:{{ mysql_primary_gr_port }}"
group_replication_group_seeds="mysql_primary:{{ mysql_primary_gr_port }},mysql_secondary1:{{ mysql_secondary1_gr_port }},mysql_secondary2:{{ mysql_secondary2_gr_port }}"
group_replication_ip_allowlist="mysql_primary,mysql_secondary1,mysql_secondary2"
group_replication_recovery_retry_count=10
group_replication_recovery_reconnect_interval=60
group_replication_consistency=EVENTUAL

# Replication settings
server_id={{ mysql_server_id_primary }}
binlog_format=ROW
binlog_checksum=NONE
log_bin=mysql-bin
log_slave_updates=ON
gtid_mode=ON
enforce_gtid_consistency=ON
master_info_repository=TABLE
relay_log_info_repository=TABLE
transaction_write_set_extraction=XXHASH64
binlog_transaction_dependency_tracking=WRITESET
sync_binlog=1

# Performance tuning
max_connections={{ mysql_max_connections }}

[client]
default-character-set={{ mysql_character_set }}

[mysql]
default-character-set={{ mysql_character_set }} 